/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package sample

fun calculateScore(input: String) = convertToFrames(input).sumOf { it.score }

private fun convertToFrames(input: String): List<Frame> {
    val stringFrames = input.replace('-', '0').split("||", "|")
    val frameData = stringFrames.windowed(3, 1, true).take(10)

    return frameData.map {
        val frame = it.first()

        if (frame == "X") {
            val firstRoll = 10
            val nextFrame = it[1]
            var firstBonusRoll: Int
            var secondBonusRoll: Int

            if (nextFrame == "X") {
                val frameAfterNext = it[2]
                firstBonusRoll = 10
                secondBonusRoll = if (frameAfterNext == "X") 10 else frameAfterNext[0].digitToInt()
            } else {
                val bonusRolls = getRollsScores(nextFrame)
                firstBonusRoll = bonusRolls.first
                secondBonusRoll = bonusRolls.second
            }

            Frame(firstRoll, firstBonusRoll = firstBonusRoll, secondBonusRoll = secondBonusRoll)
        } else {
            val (firstRoll, secondRoll) = getRollsScores(frame)

            Frame(firstRoll, secondRoll)
        }
    }
}

private fun getRollsScores(frame: String): Pair<Int, Int> = Pair(frame[0].digitToInt(), frame[1].digitToInt())
