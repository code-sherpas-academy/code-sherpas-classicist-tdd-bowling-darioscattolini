/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package sample

fun calculateScore(input: String) = convertToFrames(input).sumOf { it.score }

private fun convertToFrames(input: String): List<Frame> {
    val stringFrames = input.replace('-', '0').split("||", "|")
    val frameData = stringFrames.windowed(3, 1, true)
        .take(10)
        .map { Triple(it[0], it.getOrElse(1) { "00" }, it.getOrElse(2) { "00" }) }

    return frameData.map(buildFrame)
}

private val buildFrame = { frameData: Triple<String, String, String> ->
    val (frame, nextFrame, frameAfterNext) = frameData

    if (frame == "X") {
        val firstRoll = 10
        var firstBonusRoll: Int
        var secondBonusRoll: Int

        if (nextFrame == "X") {
            firstBonusRoll = 10
            secondBonusRoll = if (frameAfterNext == "X") 10 else frameAfterNext[0].digitToInt()
        } else {
            val bonusRolls = getRollsScores(nextFrame)
            firstBonusRoll = bonusRolls.first
            secondBonusRoll = bonusRolls.second
        }

        Frame(firstRoll, firstBonusRoll = firstBonusRoll, secondBonusRoll = secondBonusRoll)
    } else {
        val (firstRoll, secondRoll) = getRollsScores(frame)

        Frame(firstRoll, secondRoll)
    }
}

private fun getRollsScores(frame: String): Pair<Int, Int> = Pair(frame[0].digitToInt(), frame[1].digitToInt())
